var namespace;namespace=function(a){var b,c,d,e,f,g,h;c=self,f=a.split("."),h=[];for(d=0,e=f.length;d<e;d++)b=f[d],h.push(c=(g=c[b])!=null?g:c[b]={});return h},function(){var a,b,c,d,e;a=0,c=["ms","moz","webkit","o"];for(d=0,e=c.length;d<e;d++){b=c[d];if(!!window.requestAnimationFrame)continue;window.requestAnimationFrame=window[b+"RequestAnimationFrame"],window.cancelRequestAnimationFrame=window[b+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d,e,f;return e=(new Date).getTime(),d=Math.max(0,16-(e-f)),setTimeout(function(){return b(a+d)},d),f=e+d});if(!window.cancelAnimationFrame)return window.cancelAnimationFrame=function(a){return clearTimeout(a)}}();var Random;Random=function(a,b){return b==null&&(b=a,a=0),a+Math.random()*(b-a)},Random.int=function(a,b){return b==null&&(b=a,a=0),Math.floor(a+Math.random()*(b-a))},Random.sign=function(a){return a==null&&(a=.5),Math.random()<a?1:-1},Random.bool=function(a){return a==null&&(a=.5),Math.random()<a},Random.item=function(a){return a[Math.floor(Math.random()*a.length)]};var Vector;Vector=function(){function a(a,b){this.x=a!=null?a:0,this.y=b!=null?b:0}return a.add=function(b,c){return new a(b.x+c.x,b.y+c.y)},a.sub=function(b,c){return new a(b.x-c.x,b.y-c.y)},a.project=function(a,b){return a.clone().scale(a.dot(b)/a.magSq())},a.prototype.set=function(a,b){return this.x=a,this.y=b,this},a.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.scale=function(a){return this.x*=a,this.y*=a,this},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(a){return this.x*a.y-this.y*a.x},a.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.magSq=function(){return this.x*this.x+this.y*this.y},a.prototype.dist=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,Math.sqrt(b*b+c*c)},a.prototype.distSq=function(a){var b,c;return b=a.x-this.x,c=a.y-this.y,b*b+c*c},a.prototype.norm=function(){var a;return a=Math.sqrt(this.x*this.x+this.y*this.y),this.x/=a,this.y/=a,this},a.prototype.limit=function(a){var b,c;c=this.x*this.x+this.y*this.y;if(c>a*a)return b=Math.sqrt(c),this.x/=b,this.y/=b,this.x*=a,this.y*=a,this},a.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this},a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.clear=function(){return this.x=0,this.y=0,this},a}();var Integrator;Integrator=function(){function a(){}return a.prototype.integrate=function(a,b){},a}();var Euler,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Euler=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.integrate=function(a,b,c){var d,e,f,g,h;e=new Vector,h=[];for(f=0,g=a.length;f<g;f++){d=a[f];if(!!d.fixed)continue;d.old.pos.copy(d.pos),d.acc.scale(d.massInv),e.copy(d.vel),d.vel.add(d.acc.scale(b)),d.pos.add(e.scale(b)),c&&d.vel.scale(c),h.push(d.acc.clear())}return h},b}(Integrator);var ImprovedEuler,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};ImprovedEuler=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.integrate=function(a,b,c){var d,e,f,g,h,i,j;d=new Vector,g=new Vector,e=b*b,j=[];for(h=0,i=a.length;h<i;h++){f=a[h];if(!!f.fixed)continue;f.old.pos.copy(f.pos),f.acc.scale(f.massInv),g.copy(f.vel),d.copy(f.acc),f.pos.add(g.scale(b).add(d.scale(.5*e))),f.vel.add(f.acc.scale(b)),c&&f.vel.scale(c),j.push(f.acc.clear())}return j},b}(Integrator);var Verlet,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Verlet=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.integrate=function(a,b,c){var d,e,f,g,h,i;f=new Vector,d=b*b,i=[];for(g=0,h=a.length;g<h;g++){e=a[g];if(!!e.fixed)continue;e.acc.scale(e.massInv),e.vel.copy(e.pos).sub(e.old.pos),c&&e.vel.scale(c),f.copy(e.pos).add(e.vel.add(e.acc.scale(d))),e.old.pos.copy(e.pos),e.pos.copy(f),i.push(e.acc.clear())}return i},b}(Integrator);var Particle;Particle=function(){function a(b){this.mass=b!=null?b:1,this.id="p"+a.GUID++,this.setMass(this.mass),this.setRadius(1),this.fixed=!1,this.behaviours=[],this.pos=new Vector,this.vel=new Vector,this.acc=new Vector,this.old={pos:new Vector,vel:new Vector,acc:new Vector}}return a.GUID=0,a.prototype.moveTo=function(a){return this.pos.copy(a),this.old.pos.copy(a)},a.prototype.setMass=function(a){return this.mass=a!=null?a:1,this.massInv=1/this.mass},a.prototype.setRadius=function(a){return this.radius=a!=null?a:1,this.radiusSq=this.radius*this.radius},a.prototype.update=function(a,b){var c,d,e,f,g;if(!this.fixed){f=this.behaviours,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(c.apply(this,a,b));return g}},a}();var Physics;Physics=function(){function a(a){this.integrator=a!=null?a:new Euler,this.timestep=1/60,this.viscosity=.005,this.behaviours=[],this._time=0,this._step=0,this._clock=null,this._buffer=0,this._maxSteps=4,this.particles=[],this.springs=[]}return a.prototype.integrate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;c=1-this.viscosity,m=this.particles;for(d=g=0,j=m.length;g<j;d=++g){e=m[d],n=this.behaviours;for(h=0,k=n.length;h<k;h++)b=n[h],b.apply(e,a,d);e.update(a,d)}this.integrator.integrate(this.particles,a,c),o=this.springs,p=[];for(i=0,l=o.length;i<l;i++)f=o[i],p.push(f.apply());return p},a.prototype.step=function(){var a,b,c,d;(d=this._clock)==null&&(this._clock=(new Date).getTime()),c=(new Date).getTime(),a=c-this._clock;if(a<=0)return;a*=.001,this._clock=c,this._buffer+=a,b=0;while(this._buffer>=this.timestep&&++b<this._maxSteps)this.integrate(this.timestep),this._buffer-=this.timestep,this._time+=this.timestep;return this._step=(new Date).getTime()-c},a.prototype.destroy=function(){return this.integrator=null,this.particles=null,this.springs=null},a}();var Spring;Spring=function(){function a(a,b,c,d){this.p1=a,this.p2=b,this.restLength=c!=null?c:100,this.stiffness=d!=null?d:1,this._delta=new Vector}return a.prototype.apply=function(){var a,b;this._delta.copy(this.p2.pos).sub(this.p1.pos),a=this._delta.mag()+1e-6,b=(a-this.restLength)/(a*(this.p1.massInv+this.p2.massInv))*this.stiffness,this.p1.fixed||this.p1.pos.add(this._delta.clone().scale(b*this.p1.massInv));if(!this.p2.fixed)return this.p2.pos.add(this._delta.scale(-b*this.p2.massInv))},a}();var Behaviour;Behaviour=function(){function a(){this.GUID=a.GUID++,this.interval=1}return a.GUID=0,a.prototype.apply=function(a,b,c){var d,e;return((e=a[d="__behaviour"+this.GUID])!=null?e:a[d]={counter:0}).counter++},a}();var Attraction,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Attraction=function(a){function b(a,c,d){this.target=a!=null?a:new Vector,this.radius=c!=null?c:1e3,this.strength=d!=null?d:100,this._delta=new Vector,this.setRadius(this.radius),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.setRadius=function(a){return this.radius=a,this.radiusSq=a*a},b.prototype.apply=function(a,b,c){var d;this._delta.copy(this.target).sub(a.pos),d=this._delta.magSq();if(d<this.radiusSq&&d>1e-6)return this._delta.norm().scale(1-d/this.radiusSq),a.acc.add(this._delta.scale(this.strength))},b}(Behaviour);var Collision,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Collision=function(a){function b(a,c){this.useMass=a!=null?a:!0,this.callback=c!=null?c:null,this.pool=[],this._delta=new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;n=this.pool.slice(c),o=[];for(l=0,m=n.length;l<m;l++){g=n[l];if(g===a)continue;this._delta.copy(g.pos).sub(a.pos),e=this._delta.magSq(),k=a.radius+g.radius,e<=k*k?(d=Math.sqrt(e),h=a.radius+g.radius-d,h+=.5,f=a.mass+g.mass,i=this.useMass?g.mass/f:.5,j=this.useMass?a.mass/f:.5,a.pos.add(this._delta.clone().norm().scale(h*-i)),g.pos.add(this._delta.norm().scale(h*j)),o.push(typeof this.callback=="function"?this.callback(a,g,h):void 0)):o.push(void 0)}return o},b}(Behaviour);var ConstantForce,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};ConstantForce=function(a){function b(a){this.force=a!=null?a:new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){return a.acc.add(this.force)},b}(Behaviour);var EdgeBounce,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};EdgeBounce=function(a){function b(a,c){this.min=a!=null?a:new Vector,this.max=c!=null?c:new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){a.pos.x-a.radius<this.min.x?a.pos.x=this.min.x+a.radius:a.pos.x+a.radius>this.max.x&&(a.pos.x=this.max.x-a.radius);if(a.pos.y-a.radius<this.min.y)return a.pos.y=this.min.y+a.radius;if(a.pos.y+a.radius>this.max.y)return a.pos.y=this.max.y-a.radius},b}(Behaviour);var EdgeWrap,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};EdgeWrap=function(a){function b(a,c){this.min=a!=null?a:new Vector,this.max=c!=null?c:new Vector,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){a.pos.x+a.radius<this.min.x?(a.pos.x=this.max.x+a.radius,a.old.pos.x=a.pos.x):a.pos.x-a.radius>this.max.x&&(a.pos.x=this.min.x-a.radius,a.old.pos.x=a.pos.x);if(a.pos.y+a.radius<this.min.y)return a.pos.y=this.max.y+a.radius,a.old.pos.y=a.pos.y;if(a.pos.y-a.radius>this.max.y)return a.pos.y=this.min.y-a.radius,a.old.pos.y=a.pos.y},b}(Behaviour);var Wander,__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Wander=function(a){function b(a,c,d){this.jitter=a!=null?a:.5,this.radius=c!=null?c:100,this.strength=d!=null?d:1,this.theta=Math.random()*Math.PI*2,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.apply=function(a,b,c){return this.theta+=(Math.random()-.5)*this.jitter*Math.PI*2,a.acc.x+=Math.cos(this.theta)*this.radius*this.strength,a.acc.y+=Math.sin(this.theta)*this.radius*this.strength},b}(Behaviour);